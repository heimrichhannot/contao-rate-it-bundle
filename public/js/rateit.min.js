var RateItRating;function doRateIt(){(function(){RateItRatings={options:{step:0.1,readonly:false,resetable:false},initialize:function(c){if(typeof c=="object"&&typeof c.url!="undefined"){this.options.url=c.url}var b=this;jQuery(".rateItRating").each(function(e,d){b.initMe(d)});return this},initMe:function(c){var b=this;if(!Browser.Engine.trident4){var d=jQuery(c);d.data("id",d.attr("id"));d.data("rateable",d.attr("rel")=="not-rateable"?false:true);d.data("wrapper",d.find(".wrapper"));d.data("textEl",d.find(".ratingText"));d.data("selected",d.find(".rateItRating-selected"));d.data("hover",d.find(".rateItRating-hover"));jQuery.when(b.getBackgroundImage(d.data("wrapper"))).done(function(e){b.options.starwidth=e[0];b.options.starheight=e[1]/3});if(b.options.starwidth===undefined||b.options.starwidth<16){b.options.starwidth=16}if(b.options.starheight===undefined||b.options.starheight<16){b.options.starheight=16}b.setBackgroundPosition(d.data("selected"),-1*b.options.starheight);b.setBackgroundPosition(d.data("hover"),-1*2*b.options.starheight);d.data("starPercent",b.getStarPercent(d.data("id")));d.data("ratableId",b.getRatableId(d.data("id")));d.data("ratableType",b.getRatableType(d.data("id")));b.options.max=b.getRatableMaxValue(d.data("id"));d.data("selected").css("height",b.options.starheight);d.data("hover").css("height",b.options.starheight);d.data("wrapper").css("width",b.options.starwidth*b.options.max);d.data("wrapper").css("min-width",b.options.starwidth*b.options.max);d.data("wrapper").css("height",b.options.starheight);b.fillVote(d.data("starPercent"),d);d.data("currentFill",b.getFillPercent(d.data("starPercent")));if(d.data("rateable")){d.data("wrapper").mouseenter(function(e){d.data("selected").hide(500,"easeInOutQuad");d.data("hover").show();d.data("wrapper").mousemove({el:d,self:b},b.mouseCrap)});d.data("wrapper").mouseleave(function(e){d.data("wrapper").unbind("mousemove");d.data("hover").hide();d.data("selected").show();d.data("selected").animate({width:d.data("currentFill")},500)});d.data("wrapper").on("click",function(g){g.data={el:d,self:b};b.mouseCrap(g);d.data("oldTxt",d.data("textEl").text());d.data("textEl").html("");d.data("currentFill",d.data("newFill"));if(typeof(jQuery(".mbrateItRating"))!="undefined"&&d.data("id").indexOf("mb")==0){var f=d.data("id");f=f.replace("mb","");if(typeof(arrRatings)=="object"){for(var e=0;e<arrRatings.length;e++){if(arrRatings[e].rateItID==f){arrRatings[e].rated=true;arrRatings[e].width=d.data("hover").css("width");break}}}if(typeof(jQuery("#"+a(f)))!="undefined"){var h=jQuery("#"+a(f)).find(".wrapper");h.unbind();h.find(".rateItRating-selected").css("display","none");h.find(".rateItRating-hover").css("width",d.data("hover").css("width"));h.find(".rateItRating-hover").css("display","block")}}else{if(typeof(arrRatings)=="object"){for(var e=0;e<arrRatings.length;e++){if(arrRatings[e].rateItID==d.data("id")){arrRatings[e].rated=true;arrRatings[e].width=d.data("hover").css("width");break}}}}if(!d.children(".rateItRating-send").length){d.append('<button class="rateItRating-send">Bewertung absenden</button>')}d.find(".rateItRating-send").on("click",function(){d.data("wrapper").unbind();d.data("textEl").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");d.data("textEl").addClass("loading");var i=b.getVotePercent(d.data("newFill"));if(b.options.url!=null){jQuery.ajax({url:b.options.url,type:"post",data:{vote:i,id:d.data("ratableId"),type:d.data("ratableType")}}).done(function(j){d.data("updateText")(d,j);d.find(".rateItRating-send").remove()})}})})}d.data("updateText",b.updateText)}else{alert("Ich bin ein IE6")}},fillVote:function(c,b){b.data("newFill",this.getFillPercent(c));if(this.getVotePercent(b.data("newFill"))>100){b.data("newFill",this.getFillPercent(100))}b.data("selected").css("width",b.data("newFill"))},mouseCrap:function(g){var e=g.data.el;var d=g.data.self;var i=g.originalEvent.layerX;if(!i){i=g.originalEvent.offsetX}var h=d.getVotePercent(i);var b=Math.ceil((h/100)*d.options.max);var c=b*d.options.starwidth;if(parseInt(e.data("hover").css("width"))!=c){e.data("selected").css("display","none");e.data("hover").css("width",Math.min(c,d.options.starwidth*d.options.max));e.data("hover").css("display","block")}var f=b/d.options.max*100;d.fillVote(f,e)},getStarPercent:function(f){var b=f.match(/(\d*\|?\d*)-(page|article|ce|module|news|faq|galpic|news4ward)-(\d*\.?\d+)_(\d*\.?\d+)$/);if(b!=null){var e=parseFloat(b[3]);var d=parseFloat(b[4]);var c=(e/d)*100;return c}else{return 0}},getFillPercent:function(b){return(b/100)*(this.options.starwidth*this.options.max)},getVotePercent:function(c){var b=this.options.starwidth*this.options.max;var d=(c/b*100).toFixed(2);return d},getRatableId:function(c){var b=c.match(/(\d*\|?\d*)-(page|article|ce|module|news|faq|galpic|news4ward)-(\d*\.?\d+)_(\d*\.?\d+)$/);return b!=null?b[1]:""},getRatableType:function(c){var b=c.match(/(\d*\|?\d*)-(page|article|ce|module|news|faq|galpic|news4ward)-(\d*\.?\d+)_(\d*\.?\d+)$/);return b!=null?b[2]:""},getRatableMaxValue:function(c){var b=c.match(/(\d*\|?\d*)-(page|article|ce|module|news|faq|galpic|news4ward)-(\d*\.?\d+)_(\d*\.?\d+)$/);return b!=null?parseInt(b[4]):0},setBackgroundPosition:function(b,c){b.css("background-position","0% "+c+"px")},getBackgroundImagePath:function(b){return b.css("background-image")},getBackgroundImage:function(d){var b=jQuery.Deferred();var f=new Array();var e=/url\s*\(["']?(.*)["']?\)/i;var c=this.getBackgroundImagePath(d);c=c.match(e)[1];c=c.replace('"',"");jQuery("<img/>").attr("src",c).load(function(){f.push(this.width);f.push(this.height);b.resolve(f)});return b.promise()},updateText:function(c,e){error=e.split("ERROR:")[1];c.data("textEl").removeClass("loading");if(error){this.RateItRating.showError(c,error);return false}c.data("textEl").text(e);if(typeof(jQuery(".mbrateItRating"))!="undefined"&&c.data("id").indexOf("mb")==0){var d=c.attr("id");d=d.replace("mb","");if(typeof(arrRatings)=="object"){for(var b=0;b<arrRatings.length;b++){if(arrRatings[b].rateItID==d){arrRatings[b].description=e;break}}}if(typeof(jQuery("#"+a(d)))!="undefined"){jQuery("#"+a(d)).find(".ratingText").text(e)}}else{if(typeof(arrRatings)=="object"){for(var b=0;b<arrRatings.length;b++){if(arrRatings[b].rateItID==c.data("id")){arrRatings[b].description=e;break}}}}},showError:function(c,b){c.data("textEl").addClass("ratingError");c.data("textEl").text(b);setTimeout(function(){c.data("textEl").text(c.data("oldTxt"));c.data("textEl").removeClass("ratingError")},2000)}}})(jQuery);jQuery(document).ready(function(){jQuery.ajax({type:"GET",url:"system/modules/rateit/public/js/jquery-ui-effects.custom.min.js",dataType:"script",async:false,cache:true});jQuery.ajax({type:"GET",url:"system/modules/rateit/public/js/helper.min.js",dataType:"script",async:false,cache:true});RateItRating=Object.create(RateItRatings).initialize({url:"system/modules/rateit/public/php/rateit-ajax.php?do=rateit"})});var a=function(b){b=b.replace(new RegExp("\\$","g"),"\\$");b=b.replace(new RegExp("~","g"),"\\~");b=b.replace(new RegExp("\\[","g"),"\\[");b=b.replace(new RegExp("\\]","g"),"\\]");b=b.replace(new RegExp("\\|","g"),"\\|");b=b.replace(new RegExp("\\.","g"),"\\.");b=b.replace(new RegExp("#","g"),"\\#");return b}}onReadyRateIt(function(){doRateIt()});